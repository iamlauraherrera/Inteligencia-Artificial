<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>TicTacToe – Minimax</title>
<style>
:root { font-family: system-ui, -apple-system, Segoe UI, Roboto; }
body { margin:0; background:#0f172a; color:#e5e7eb; }
header { display:flex; align-items:center; padding:12px 16px; background:#111827; border-bottom:1px solid #1f2937; }
h1 { margin:0; font-size:1.05rem; color:#fafafa; }
.container { max-width:820px; margin:20px auto; padding:0 16px; display:grid; grid-template-columns: 1fr 320px; gap:16px; }
.card{ background:#111827; border:1px solid #1f2937; border-radius:14px; padding:16px; }
.title{ font-weight:600; color:#fafafa; margin-bottom:8px; }
#board.grid{ display:grid; gap:6px; padding:8px; border-radius:12px; background:#0b101d; }
.cell{ display:flex; align-items:center; justify-content:center; background:#1f2937; border-radius:8px; aspect-ratio:1/1; font-size:2.2rem; font-weight:700; transition:transform .12s ease, background .2s ease; }
.cell:hover{ transform:translateY(-1px); background:#243041; cursor:pointer; }
.cell.win{ background:#064e3b !important; box-shadow:0 0 18px rgba(34,197,94,.35); }
.btn{ background:#2563eb; color:#e5e7eb; border:1px solid #2563eb; border-radius:10px; padding:10px 14px; margin-right:8px; }
.btn.secondary{ background:#374151; border-color:#374151; }
.status{ min-height:1.1em; color:#cbd5e1; }
</style>
</head>
<body>
<header><h1>TicTacToe – Minimax</h1></header>

<div class="container">
  <div class="card">
    <div class="title">Tablero</div>
    <div id="board" class="grid"></div>
  </div>
  <div class="card">
    <div class="title">Controles</div>
    <div>
      <button class="btn" id="ai">Jugar IA</button>
      <button class="btn secondary" id="reset">Reiniciar</button>
      <a href="/" class="btn secondary">Volver</a>
    </div>
    <div class="title" style="margin-top:10px;">Estado</div>
    <div id="status" class="status"></div>
  </div>
</div>

<script>
const name = "{{ name }}"; // "minimax-algorithm.py"
const board = document.getElementById('board');
const statusBox = document.getElementById('status');

async function j(url, opts={}){ const r = await fetch(url, opts); return r.json(); }
async function getState(){ return j(`/api/${name}/state`); }
async function act(action){
  return j(`/api/${name}/act`, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({action})});
}
async function restart(){ return j(`/api/${name}/restart`, {method:'POST'}); }

function render(state){
  const cells = state.board || Array(9).fill('-');
  const winline = state.winline || [];
  board.innerHTML = '';
  board.style.gridTemplateColumns = 'repeat(3, 1fr)';
  for (let i=0;i<9;i++){
    const v = cells[i];
    const c = document.createElement('div');
    c.className = 'cell';
    if (winline.includes(i)) c.classList.add('win');
    c.textContent = v === '-' ? '' : v;
    if (v === '-') c.onclick = ()=> act(`move:${i}`).then(update);
    else c.style.opacity = .7;
    board.appendChild(c);
  }
  statusBox.textContent = state.msg || '';
}

async function update(){ const jn = await getState(); render(jn.estado); }
document.getElementById('ai').onclick = ()=> act('ai').then(update);
document.getElementById('reset').onclick = ()=> restart().then(update);
update();
</script>
</body>
</html>
